<dom-module id="app-main">
  <link rel="stylesheet" href="app-main.css">
  <link rel="import" href="../../elements/menu-panel/menu-panel.html">
  <template>
    <iron-ajax url="/advert/list" last-response="{{data}}" auto></iron-ajax>

    <paper-drawer-panel>

      <menu-panel drawer>
      </menu-panel>



      <paper-header-panel condenses keep-condensed-header main>
          <paper-toolbar class="medium">
            <div class="spacer"></div>
            <paper-icon-button icon="add" alt="Search"></paper-icon-button>
            <paper-icon-button icon="more-vert" alt="More options"></paper-icon-button>
            <paper-button data-dialog="login-modal" id="login-button">modal dialog</paper-button>
          </paper-toolbar>
          <paper-dialog id="login-modal" modal>
            <p>Login to add some advert.</p>
            <div class="buttons">
              <paper-button dialog-confirm autofocus>Close</paper-button>
            </div>
          </paper-dialog>
        <iron-list items="[[data]]" as="item">
          <template>
            <div>
              <div class="item">
                <img class="avatar" src="[[item.image]]">
                <div class="pad">
                  <div class="primary">[[item.name]]</div>
                  <div class="secondary">[[item.shortText]]</div>
                  <div class="secondary dim">[[item.longText]]</div>
                </div>
                <iron-icon icon$="[[iconForItem(item)]]"></iron-icon>
              </div>
            </div>
          </template>
        </iron-list>
      </paper-header-panel>
    </paper-drawer-panel>
  </template>
  <script>
    Polymer({
      is: "app-main",
      listeners: {
        'login-button.click': 'loginClickHandler'
      },
      loginClickHandler: function(e){
        var button = e.target;
        while (!button.hasAttribute('data-dialog') && button !== document.body) {
          button = button.parentElement;
        }
        if (!button.hasAttribute('data-dialog')) {
          return;
        }
        var id = button.getAttribute('data-dialog');
        var dialog = document.getElementById(id);
        if (dialog) {
          dialog.open();
        }
      }
    });
  </script>
</dom-module>
