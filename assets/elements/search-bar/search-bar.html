<!doctype html>
<dom-module id="search-bar">
		<template>
		<style>
		 :host {
			 display: block;
			 @apply(--paper-font-common-base);
		 }

		 iron-list {
			 padding-bottom: 16px;
		 }

		 .photoContent {
			 @apply(--layout);
			 background-color: #ddd;
			 position: relative;
			 width: 300px;
			 height: 300px;
			 margin: 8px;
		 }

		 .photoContent > iron-image {
			 @apply(--layout-flex);
		 }
		 .photoContent > .detail {
			 position: absolute;
			 bottom: 0;
			 left: 0;
			 right: 0;
			 background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%);
			 color: white;
			 font-size: 20px;
			 font-weight: 100;
			 padding: 20px;
		 }


		 .loadingIndicator {
			 font-size: 16px;
			 text-align: center;
			 height: 60px;
		 }
		 .loadingIndicator paper-spinner {
			 margin-right: 20px;
			 vertical-align: middle;
		 }
		 @media (max-width: 800px) {
			 .photoContainer {
				 width: calc(50% - 16px);
			 }
			 .photoContent {
				 width: auto;
			 }
		 }
		 @media (max-width: 400px) {
			 .photoContainer {
				 width: 100%;
			 }
			 .photoContent > .detail {
				 opacity: 1;
			 }
		 }

	 </style>
			<iron-ajax id="advertAjax" url="/advert/list" on-response="handleResponse"></iron-ajax>
			<paper-search-panel
				placeholder="Search ..."
				hide-filter-button="[[hideFilterButton]]"
				search="{{search}}"
				count="{{count}}"
				items="{{adverts}}"
				has-more="[[hasMore]]"
				loading="[[loading]]"
				filters="[[filters]]"
				selected-filters="{{selectedFilters}}"
				on-change-request-params="loadData">
			</paper-search-panel>
			<iron-list items="[[adverts]]" as="item" grid>
				<template>
					<div class="photoContainer">
            <div class="photoContent" tabindex$="[[tabIndex]]">
							<template is="dom-repeat" items="{{item.images}}" as="image">
								<template is="dom-if" if="{{_continueLoop(index)}}" indexAs="index">
			            <iron-image sizing="cover"
			                src="http://res.cloudinary.com/dk2nkldll/h_300/[[image]]">

			            </iron-image>
								</template>
							</template>
              <div class="detail">
								<span>[[item.title]]</span>
								<br />
								<span>[[item.price]]</span>
								<br />
								<p>
									[[item.advertBody]]
								</p>
							</div>

            </div>
          </div>

				</template>
			</iron-list>

		</template>

		<script>
      Polymer({
        is: "search-bar",
				open : function() {
					this.$.dialog.open();
				},
				loadData : function() {
					// Simulate a 100ms data load
					this.loading = true;
					if (this.$.advertAjax.lastRequest) {
            this.$.advertAjax.lastRequest.abort();
          }

					this.$.advertAjax.generateRequest();
				},
				handleResponse: function(e){
					this.loading = false;
					if (e && e.detail && e.detail.response){
						e.detail.response.forEach(function(item){
							this.push('adverts', item);
						}, this);
					}
				},
				properties : {
					adverts: {
					 type: Array,
					 value: []
				 },
					hasMore : {
						type: Boolean,
						value: true
					},

					selectedFilters : {
						type: Object,
						value: {
							advertType: [ "buy", "give" ],
							advertCategory: [ "sail" ]
						}
					},
					filters : {
						type: Array,
						value: [
							{
								id: "advertType",
								name: "Advert Type",
								values: [
									{
										id: "buy",
										name: "Buy",
									},
									{
										id: "sell",
										name: "Sell",
									},
									{
										id: "give",
										name: "Give",
									}
								]
							},
							{
								id: "advertCategory",
								name: "Advert Category",
								values: [
									{
										id: "sail",
										name: "Sail"
									},
									{
										id: "board",
										name: "Board"
									}
								]
							}
						]
					}
				},
				_continueLoop: function(index){
					if (index > 0) {
						return false;
					}
					return true;
				}

      });
		</script>
</dom-module>
